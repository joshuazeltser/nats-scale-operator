FROM golang:1.24

# Install necessary tools
RUN apt-get update && apt-get install -y make curl unzip

# Set working directory
WORKDIR /workspace

# Copy entire project
COPY . .

# Download Go modules
RUN go mod download

# Install envtest binaries via Makefile
RUN make envtest

# Optional: install ginkgo
RUN go install github.com/onsi/ginkgo/v2/ginkgo@v2.15.0

# Run tests (choose one)
#CMD ["go", "test", "-v", "./internal/controller"]
# or, if using ginkgo:
 CMD ["ginkgo", "-v", "./internal/controller"]
